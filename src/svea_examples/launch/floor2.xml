<?xml version="1.0"?>
<launch>
    <!-- Launch file arguments -->
    
    <arg name="is_sim"          default="true"/>
    <arg name="use_foxglove"    default="true"/>
    <arg name="initial_pose_x"  default="-7.4"/>
    <arg name="initial_pose_y"  default="-15.4"/>
    <arg name="initial_pose_a"  default="+0.9"/>
    
    <arg name="points" default="'[[-2.3, -7.1], [10.5, 11.7], [5.7,  15.0], [-7.0, -4.0]]'"/>

    <let name="map" value="floor2"/>

    <!-- Start Map Server and Foxglove -->
    <include file="$(find-pkg-share svea_core)/launch/map_and_foxglove.xml">
        <arg name="map" value="$(var map)" />
        <arg name="use_foxglove" value="$(var use_foxglove)" />
    </include>

    <!-- Real SVEA -->
    <group unless="$(var is_sim)">
        <include file="$(find-pkg-share svea_core)/launch/svea.xml">
            <arg name="is_sim" value="$(var is_sim)"/>
            <arg name="initial_pose_x" value="$(var initial_pose_x)" />
            <arg name="initial_pose_y" value="$(var initial_pose_y)" />
            <arg name="initial_pose_a" value="$(var initial_pose_a)" />
            <arg name="map" value="$(var map)" />
        </include>
        
        <!-- Start pure_pursuit -->
        <node name="pure_pursuit" pkg="svea_examples" exec="pure_pursuit.py" output="screen">
            <param name="is_sim" value="$(var is_sim)"/>
            <param name="points" value="$(var points)" />
        </node>
    </group>
    
    <!-- SVEA-A -->
    <group if="$(var is_sim)">
        <let name="name" value="svea_a"/>

        <include file="$(find-pkg-share svea_core)/launch/svea.xml">
            <arg name="name" value="$(var name)" />
            <arg name="is_sim" value="$(var is_sim)"/>
            <arg name="initial_pose_x" value="$(var initial_pose_x)"/>
            <arg name="initial_pose_y" value="$(var initial_pose_y)"/>
            <arg name="initial_pose_a" value="$(var initial_pose_a)"/>
            <arg name="map" value="$(var map)"/>
        </include>

        <push-ros-namespace namespace="$(var name)"/>

        <!-- Start pure_pursuit -->
        <node name="pure_pursuit" pkg="svea_examples" exec="pure_pursuit.py" output="screen">
            <param name="is_sim" value="$(var is_sim)"/>
            <param name="points" value="$(var points)"/>
            <param name="localization/base_frame" value="$(var name)/base_link"/>
            <!-- Allow namespace -->
            <param name="steering_top" value="lli/ctrl/steering"/>
            <param name="throttle_top" value="lli/ctrl/throttle"/>
            <param name="highgear_top" value="lli/ctrl/highgear"/>
            <param name="diff_top" value="lli/ctrl/diff"/>
        </node>
    </group>

    <!-- SVEA-B -->
    <group if="$(var is_sim)">
        <let name="name" value="svea_b"/>

        <include file="$(find-pkg-share svea_core)/launch/svea.xml">
            <arg name="name" value="$(var name)" />
            <arg name="is_sim" value="$(var is_sim)"/>
            <arg name="initial_pose_x" value="0.0"/>
            <arg name="initial_pose_y" value="0.0"/>
            <arg name="initial_pose_a" value="$(var initial_pose_a)"/>
            <arg name="map" value="$(var map)"/>
        </include>

        <push-ros-namespace namespace="$(var name)"/>

        <!-- Start pure_pursuit -->
        <node name="pure_pursuit" pkg="svea_examples" exec="pure_pursuit.py" output="screen">
            <param name="is_sim" value="$(var is_sim)"/>
            <param name="points" value="$(var points)"/>
            <param name="target_velocity" value="0.4"/>
            <param name="localization/base_frame" value="$(var name)/base_link"/>
            <!-- Allow namespace -->
            <param name="steering_top" value="lli/ctrl/steering"/>
            <param name="throttle_top" value="lli/ctrl/throttle"/>
            <param name="highgear_top" value="lli/ctrl/highgear"/>
            <param name="diff_top" value="lli/ctrl/diff"/>
        </node>
    </group>


</launch>
